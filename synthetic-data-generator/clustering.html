<html>
  <head>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"/>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

<style>

*{
    margin: 0%;
    padding: 0%;
    box-sizing: border-box;
    font-family: arial,sans-serif;
}

.container{
    display: flex;
    align-items: center;
    justify-content: center;
    height: 90vh;
}

.title{
    width: 100%;
    font-size: 32px;
    font-weight: bolder;
    text-align: center;
    background-color: aliceblue;
}

.left-container{
    width: 25vw;
    height: 100%;
    padding: 10px;
    background-color: aliceblue;
}

form, .data-description{
    width: 100%;
    padding: 10px;
    background-color: rgb(240, 240, 240);
    border-radius: 6px;
    box-shadow: 0px 0px 8px gray;
}

.data-description{
    margin-top: 20px;
}

#data-description{
    display: flex;
    align-items: center;
    justify-content: center;
}

h3{
  width: 100%;
  text-align: center;
  padding-bottom: 6px;
}

table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
  padding: 4px;
}

label{
    width: 100%;
    display: block;
    font-size: 18px;
}

input{
    background-color: white;
    border-radius: 4px;
    font-size: 18px;
    height: 32px;
    width: 50%;
    margin-bottom: 10px;
}

button {
    text-decoration:none;
    width: 100%;
    background-color: rgb(200, 200, 200);
    border: 1px solid rgb(200, 200, 200);
    border-radius: 4px;
    color: black;
    font-family: arial,sans-serif;
    font-size: 18px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center; 
    cursor: pointer;
    margin-top: 20px;
}

button:hover{
    border: 1px solid black;
}

.right-container{
    width: 25vw;
    height: 100%;
    padding: 10px;
    background-color: aliceblue;
}

#graph-area{
    width: 50vw;
    height: 100%;
    display: flex;
    justify-content: center;
}

</style>
  </head>
  <body>
    <div class="title">Clustering with Synthetic Data</div>
    <div class="container">
      <div class="left-container">
        <form>
            <h3>Data Generation Options</h3>
            <label for="no_of_cluster">Number of clusters:</label>
            <input type="number" id="no_of_cluster" placeholder="Number of clusters" value="4" step="1"/>
            <br>
            <label for="num_datapoints">Number of rows:</label>
            <input type="number" id="num_datapoints" placeholder="Number of rows" value="150" step="1"/>
            <br>
            <label for="no_of_dimensions">Number of dimensions: (2 or 3)</label>
            <input type="number" id="no_of_dimensions" placeholder="Number of dimensions" value="2" min="2" max="3" step="1"/>
            <br>
            <label for="overlap_percentage">Overlap Percentage:</label>
            <input type="number" id="overlap_percentage" placeholder="Overlap Percentage" value="0" min="0" max="1" step=".01"/>
            <br>
            <label for="l">Linear combination:</label>
            <input type="number" id="l" placeholder="Linear combination" value="1" min="1" max="10" step="1"/>
            <br>
            <button onclick="get_value()" py-click="generate_overlapping_clusters(js.no_of_cluster, js.no_of_dimensions, js.num_datapoints, js.overlap_percentage, js.l)" type="button">
                Generate Data
            </button>
        </form>

        <div class="data-description">
          <h3>Data Description</h3>
          <div id="data-description">please generate data!</div>
        </div>

      </div>
  
      
      <div id="graph-area"></div>
  
      <div class="right-container"></div>
    </div>
    
    <script>
        var no_of_cluster = parseInt(document.getElementById("no_of_cluster").value);
        var num_datapoints = parseInt(document.getElementById("num_datapoints").value);
        var no_of_dimensions = parseInt(document.getElementById("no_of_dimensions").value);
        var overlap_percentage = parseFloat(document.getElementById("overlap_percentage").value);
        var l = parseInt(document.getElementById("l").value);
    
        function get_value() {
            no_of_cluster = parseInt(document.getElementById("no_of_cluster").value);
            num_datapoints = parseInt(document.getElementById("num_datapoints").value);
            no_of_dimensions = parseInt(document.getElementById("no_of_dimensions").value);
            overlap_percentage = parseFloat(document.getElementById("overlap_percentage").value);
            l = parseInt(document.getElementById("l").value);
        }
    </script>

    <py-config>
      packages = ["numpy", "pandas", "matplotlib"]
    </py-config>

    <py-script>
        import js
        import numpy as np
        import pandas as pd
        import matplotlib.pyplot as plt
        
        np.random.seed(42)
        
        def generate_overlapping_clusters(num_clusters, num_dimensions, num_datapoints, overlap_percentage, L):
        
            range_list = []
        
            for i in range(num_clusters*2):
                if i == 0:
                    range_list.append(np.random.uniform(0, L))
                if i > 0 and i % 2 == 0:
                    range_list.append(range_list[i-1] - L * (overlap_percentage ** (1 / num_dimensions)))
                if i % 2 != 0:
                    range_list.append(range_list[i-1] + L)
        
            
            points_per_cluster = num_datapoints // num_clusters
            col_dict = {}
        
            for dimension in range(0,num_dimensions):
                col_data = np.array([])
                for cluster in range(0,len(range_list),2):
                    cluster_data = np.random.uniform(range_list[cluster], range_list[cluster+1], points_per_cluster)
                    col_data = np.append(col_data,cluster_data)
                    col_dict[f"Random Col {dimension+1}"] = col_data
            
        
            global df
            df = pd.DataFrame(col_dict)


            # Plot
            
            Element('graph-area').clear()            
            
            
            if(num_dimensions == 2):
                plt.scatter(df.iloc[:,0], df.iloc[:,1])
                plt.title('Plot of Cluster Data')
                display(plt, target="graph-area")
                plt.clf()
            
            if(num_dimensions == 3):
                ax = plt.axes(projection ="3d")
                ax.scatter3D(df.iloc[:,0], df.iloc[:,1], df.iloc[:,2])
                plt.title('Plot of Cluster Data')
                display(plt, target="graph-area")
                plt.clf()
        

            # display description on page
            description_div = Element("data-description")
            description_div.element.innerHTML = df.describe().to_html()

                

    </py-script>

  </body>
</html>